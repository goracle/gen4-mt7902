============================================================
PATCH 1 of 4 — os/linux/hif/pcie/include/hif.h

Three insertion points, marked by the exact existing lines that
bracket them.  No existing line is deleted or modified.
============================================================

--- a/os/linux/hif/pcie/include/hif.h
+++ b/os/linux/hif/pcie/include/hif.h

---------------------------------------------------------------
INSERTION A — right BEFORE "enum pcie_suspend_state {"
  (that enum is already in the file; these two new enums go above it)
---------------------------------------------------------------

+/* ---------------------------------------------------------------------------
+ * Recovery-stage enum.  Separate from ERR_RECOV_* (hal.h:103) which tracks
+ * the L1 soft-error state machine.  These stamp where the Tier-3 PCIe
+ * function-recovery sequence was when it stopped.
+ * ---------------------------------------------------------------------------
+ */
+enum pcie_recovery_stage {
+	RECOV_STAGE_IDLE            = 0,
+	RECOV_STAGE_QUIESCE         = 1,
+	RECOV_STAGE_D3COLD_CYCLE    = 2,
+	RECOV_STAGE_REENABLE        = 3,
+	RECOV_STAGE_BAR_REMAP       = 4,
+	RECOV_STAGE_SBR             = 5,
+	RECOV_STAGE_BAR_PREFLIGHT   = 6,
+	RECOV_STAGE_WFSYS_PWRCYCLE  = 7,
+	RECOV_STAGE_CLOCKS          = 8,
+	RECOV_STAGE_LINK_WAIT       = 9,
+	RECOV_STAGE_PHASED_WAKE     = 10,
+	RECOV_STAGE_DMA_PURGE       = 11,
+	RECOV_STAGE_MCU_KICKSTART   = 12,
+	RECOV_STAGE_BAR_TIER7       = 13,
+	RECOV_STAGE_MCU_COLDBOOT    = 14,
+	RECOV_STAGE_ADAPTER_START   = 15,
+	RECOV_STAGE_COMPLETE        = 16,
+	RECOV_STAGE_NUM
+};
+
+/* Why the recovery sequence stopped.  Logged at recovery_failed and
+ * visible via debugfs.
+ */
+enum pcie_recovery_fail_reason {
+	RECOV_FAIL_NONE              = 0,
+	RECOV_FAIL_BAR_BLIND_PRE     = 1,
+	RECOV_FAIL_BAR_BLIND_TIER7   = 2,
+	RECOV_FAIL_COLDBOOT_BLIND    = 3,
+	RECOV_FAIL_COLDBOOT_TIMEOUT  = 4,
+	RECOV_FAIL_COLDBOOT_OTHER    = 5,
+	RECOV_FAIL_ADAPTER_START     = 6,
+	RECOV_FAIL_ENABLE_DEVICE     = 7,
+	RECOV_FAIL_IOREMAP           = 8,
+	RECOV_FAIL_NUM
+};
+
 enum pcie_suspend_state {

---------------------------------------------------------------
INSERTION B — right AFTER "bool fgInPciRecovery;"
  inside struct GL_HIF_INFO, before "enum pcie_suspend_state eSuspendtate;"
---------------------------------------------------------------

 	bool fgInPciRecovery;      /* True while doing PCIe function recovery */
+
+	/* --- Tier-3 recovery observability ---------------------------------- */
+	uint8_t  u8RecoveryStage;          /* enum pcie_recovery_stage        */
+	uint8_t  u8RecoveryFailReason;     /* enum pcie_recovery_fail_reason  */
+	uint32_t u4LastBarSample;          /* last raw BAR0 dword read        */
+	unsigned long u_recovery_fail_time;/* jiffies at last failure         */
+	struct dentry *debugfs_recovery_state; /* seq_file dentry or NULL     */
+	/* --------------------------------------------------------------------- */
+
 	enum pcie_suspend_state eSuspendtate;

---------------------------------------------------------------
INSERTION C — right BEFORE the final "#endif /* _HIF_H */"
  (after struct BUS_INFO closes).  These three externs let
  gl_init.c call the dump helpers that are defined in pcie.c.
---------------------------------------------------------------

+/* Dump helpers defined in pcie.c — called from gl_init.c on cold-boot
+ * timeout so that BAR / mailbox / PDMA state is captured even when
+ * the hang originates inside asicPollWfsysSwInitDone.
+ */
+extern void dump_pci_state(struct pci_dev *pdev);
+extern void dump_mailbox(struct ADAPTER *prAdapter);
+extern void dump_pdma_state(struct ADAPTER *prAdapter);
+
 #endif /* _HIF_H */